import{w as g}from"./with-props-B93zY1wZ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{c as b,g as w,o as k,p as C}from"./art-BsMJH1cu.js";import{b as V}from"./events-yavB0MIg.js";import{a as A,g as H}from"./users-BK9jrEEb.js";import{v as I,a as u,L as h,t as T}from"./chunk-DQRVZFIR-B4fErBJ-.js";import{a as y}from"./arrow-CMmgFB8Y.js";import"./supabase-B2tzS42n.js";const F="/integration4/assets/art_vote_image-SIFXOtHT.svg";async function U({params:c}){const a=await b(Number(c.id)),r=await V(),i=await A(),n=await H(),l=await w(),p=await k(r.id,a.id);console.log("artVotes",l);const d=p.find(m=>l.some(o=>o.artId===m.id&&o.userId===i.id));return{artworks:p,artType:a,users:n,votedArt:d,currentUser:i}}async function W({request:c}){const a=await c.formData(),r=Number(a.get("artId")),i=Number(a.get("userId"));return await C(r,i),I(`/vote-complete/${r}`)}const Y=g(function({loaderData:a}){const{artworks:r,users:i,artType:n,votedArt:l,currentUser:p}=a,[d,m]=u.useState(null),[o,x]=u.useState(null),[j,v]=u.useState(!1),_=r.find(t=>t.id===Number(d)),N=t=>{m(t),v(!0),document.body.style.overflow="hidden"};return l?e.jsxs("section",{className:"vote-art-type__already-voted-section",children:[e.jsx("div",{className:"already-voted__back",children:e.jsxs(h,{to:"/vote-art",className:"back-button",children:[e.jsx("img",{src:y,alt:"Back",className:"back-button__arrow"}),"Back"]})}),e.jsxs("div",{className:"already-voted__content",children:[e.jsxs("div",{className:"already-voted__text",children:[e.jsx("h2",{children:"You already have voted"}),e.jsxs("div",{className:"already-voted__info",children:[e.jsx("p",{children:"for"}),e.jsxs("p",{className:"already-voted__name",children:['"',l.title,'"']})]})]}),e.jsx(h,{className:"button button--green",to:"/vote-art",children:"Vote Art"})]})]}):e.jsxs("main",{className:"vote-art-type",children:[e.jsxs("h1",{className:"visually-hidden",children:["Vote for ",n.name]}),e.jsxs("article",{className:"vote-art-type__intro",children:[e.jsxs("h2",{className:"visually-hidden",children:["Voting for ",n.name]}),e.jsxs("section",{className:"vote-art-type__instructions",children:[e.jsxs("h3",{className:"vote-art-type__headline",style:{backgroundImage:`url(${F})`,backgroundPosition:"bottom",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:["shape the ",n.name," "]}),e.jsx("p",{className:"vote-art-type__info",children:"You can cast exactly one vote in each category. Change your vote anytime before the deadline."})]}),e.jsxs("section",{className:"vote-art-type__countdown-box",children:[e.jsx("h3",{className:"visually-hidden",children:"Voting Timer"}),e.jsx("p",{className:"vote-art-type__timer-label",children:"Voting Ends in"}),e.jsxs("div",{className:"vote-art-type__countdown",children:[e.jsxs("p",{children:[e.jsx("span",{children:"DD"})," days"]}),e.jsxs("p",{children:[e.jsx("span",{children:"HH"})," h"]}),e.jsxs("p",{children:[e.jsx("span",{children:"MM"})," min"]})]}),e.jsxs(h,{to:"/vote-art",className:"vote-art__link",children:[e.jsx("img",{src:y,alt:"arrow",className:"vote-art__arrow"}),"Back"]})]})]}),e.jsxs("article",{className:"vote-art-type__artworks",children:[e.jsxs("h2",{className:"visually-hidden",children:["Voting for ",n.name]}),e.jsxs("div",{className:"vote-art-type__artworks-header",children:[e.jsx("h3",{className:"vote-art-type__artworks-heading",children:"ArtWorks"}),e.jsx("p",{className:"vote-art-type__artworks-info",children:"Tap a card to preview the work, then lock in your vote to send it toward victory."})]}),e.jsxs(T,{method:"post",className:"vote-art-type__form",children:[e.jsx("input",{type:"hidden",name:"userId",value:p.id}),e.jsx("div",{className:"vote-art-type__grid",children:r.map(t=>{const s=i.find(f=>f.id===t.userId);return e.jsxs("div",{className:"vote-art-type__card",children:[e.jsx("div",{className:"vote-art-type__media",children:t.url.endsWith(".mp3")?e.jsx("audio",{controls:!0,style:{width:"100%"},className:"vote-art-type__audio",children:e.jsx("source",{src:t.url,type:"audio/mpeg"})}):t.type==="video"?e.jsx("video",{controls:!0,width:"100%",className:"vote-art-type__video",children:e.jsx("source",{src:t.url,type:"video/mp4"})}):e.jsx("img",{src:t.url,alt:t.title,className:"vote-art-type__image"})}),e.jsxs("div",{className:"vote-art-type__details",children:[e.jsxs("div",{className:"vote-art-type__text",children:[e.jsx("p",{className:"vote-art-type__card-title",children:t.title}),e.jsxs("p",{className:"vote-art-type__card-creator",children:[e.jsx("strong",{children:"@"}),s==null?void 0:s.username]})]}),e.jsx("div",{className:"art-card-gallery__avatar",children:(s==null?void 0:s.avatar)===null?e.jsxs("svg",{width:"24",height:"45",viewBox:"0 0 24 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{"clip-path":"url(#clip0_828_2413)",children:[e.jsx("path",{d:"M14.5497 8.80082C14.5497 7.25126 13.2935 5.99508 11.7439 5.99507C10.1944 5.99507 8.93818 7.25124 8.93818 8.80082V9.19675H3.00293V8.80082C3.00293 3.97331 6.91643 0.0598145 11.7439 0.0598145C16.5714 0.0598262 20.4849 3.9733 20.4849 8.80082V9.19675H14.5497V8.80082Z",fill:"#231F20"}),e.jsx("path",{d:"M3.00293 8.86553V8.4696H8.93818V8.86553C8.9382 10.4151 10.1944 11.6713 11.7439 11.6713C13.2935 11.6713 14.5497 10.415 14.5497 8.86553V8.4696H20.4849V8.86553C20.4849 13.693 16.5714 17.6065 11.7439 17.6065C6.91644 17.6065 3.00295 13.693 3.00293 8.86553Z",fill:"#231F20"}),e.jsx("path",{d:"M18.0395 37.1339H5.7373V44.9037H18.0395V37.1339Z",fill:"#231F20"}),e.jsx("path",{d:"M23.3276 44.9037H15.748L10.8633 18.5237H15.2338L23.3276 44.9037Z",fill:"#231F20"}),e.jsx("path",{d:"M0.179688 44.9037H7.75937L12.644 18.5237H8.27352L0.179688 44.9037Z",fill:"#231F20"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_828_2413",children:e.jsx("rect",{width:"23.5252",height:"45",fill:"white"})})})]}):e.jsx("img",{className:"vote-art-type__avatar-image",src:s==null?void 0:s.avatar,alt:`avatar of ${s==null?void 0:s.username}`})})]}),e.jsxs("div",{className:"vote-art-type__actions",children:[e.jsx(h,{to:`/art-detail/${t.id}`,className:"vote-art-type__detail-link",children:"View Details"}),e.jsxs("label",{className:`vote-art-type__radio-label ${o==t.id?"vote-art-type__confirmed":""}`,children:[e.jsx("input",{type:"radio",name:"artId",value:t.id,checked:d==t.id,onChange:()=>N(t.id),required:!0,className:`vote-art-type__radio-input ${o==t.id?"vote-art-type__confirmed":""}`})," ",o==t.id?"Confirmed":"lock in vote"]})]})]},t.id)})}),e.jsx("button",{type:"submit",disabled:!o,className:"vote-art-type__submit",children:"Submit"})]})]}),j&&e.jsx("div",{className:"vote-art-type__popup",children:e.jsxs("div",{className:"vote-art-type__popup-inner",children:[e.jsxs("div",{className:"vote-art-type__popup-message",children:[e.jsxs("p",{className:"vote-art-type__popup-question",children:["Are you sure you want to vote for ",e.jsx("strong",{children:_==null?void 0:_.title}),"?"]}),e.jsx("p",{className:"vote-art-type__popup-warning",children:"*You wonâ€™t be able to recast your vote after it has been submitted "})]}),e.jsxs("div",{className:"vote-art-type__popup-buttons",children:[e.jsx("button",{type:"button",className:"vote-art-type__popup-btn vote-art-type__popup-btn--yes",onClick:()=>{v(!1),x(d),document.body.style.overflow=""},children:"Yes"}),e.jsx("button",{type:"button",className:"vote-art-type__popup-btn vote-art-type__popup-btn--no",onClick:()=>{v(!1),m(null),document.body.style.overflow=""},children:"No"})]})]})})]})});export{W as clientAction,U as clientLoader,Y as default};
