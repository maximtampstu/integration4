import{w as k}from"./with-props-B93zY1wZ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{s as I,x as C,a as l,L as p}from"./chunk-DQRVZFIR-B4fErBJ-.js";import{a as E,g as j,b as P,c as S}from"./theme-BOg38vji.js";import{a as D}from"./users-BK9jrEEb.js";import{B as x}from"./BackButton-B5WbHyJs.js";import{b as A,i as v,a as L}from"./events-yavB0MIg.js";import"./supabase-B2tzS42n.js";async function G(){const o=await D(),s=await A(),a=await E(),n=await j(),r=n.some(c=>c.userEmail===o.email);return{votableThemes:a,currentUser:o,hasAlreadyVoted:r,themeVotes:n,currentEvent:s}}async function H({request:o}){const s=await o.formData(),a=Number(s.get("themeId")),n=s.get("email");await P(a,n);const r=await S(await j());return console.log("test"),{leadingThemeId:r}}const Y=({loaderData:o})=>{const{votableThemes:s,currentUser:a,hasAlreadyVoted:n,themeVotes:r,currentEvent:c}=o,i=I();C();const[h,f]=l.useState(""),[_,d]=l.useState(!1),[N,g]=l.useState(!1),[m,b]=l.useState(v(c.startDate));l.useEffect(()=>{const t=setInterval(()=>{b(v(L(c.startDate)))},1e3);return()=>clearInterval(t)},[c.startDate]),i.data&&!N&&(g(!0),d(!1),document.body.style.overflow="",window.scrollTo({top:0,behavior:"smooth"}));const y=()=>{document.body.style.overflow="hidden",d(!0)},u=()=>{document.body.style.overflow="",d(!1)},w=t=>{t.preventDefault(),f(Number(t.target.themeId.value)),y()},T=()=>{i.submit({email:a.email,themeId:h},{method:"post"})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"visually-hidden",children:"Vote Theme"}),i.data?e.jsxs("section",{className:"vote-complete",children:[e.jsxs("div",{className:"vote-complete__text",children:[e.jsx("h2",{children:"Theme Locked"}),e.jsxs("div",{className:"vote-complete__info",children:[e.jsxs("p",{className:"vote-complete__winning",children:['"',s.find(t=>t.id===i.data.leadingThemeId).name,'"']}),e.jsx("p",{children:"is in the lead."})]}),e.jsx("p",{children:"Thanks for making your mark!"})]}),e.jsx(p,{className:"button button--green",to:"/previous-events",children:"See Previous Themes"})]}):n?e.jsxs("section",{className:"already-voted",children:[e.jsxs("div",{className:"already-voted__content",children:[e.jsxs("div",{className:"already-voted__text",children:[e.jsx("h2",{children:"You already have voted"}),e.jsxs("div",{className:"already-voted__info",children:[e.jsx("p",{children:"for"}),e.jsxs("p",{className:"already-voted__name",children:['"',s.find(t=>t.id===r.find(V=>V.userEmail===a.email).themeId).name,'"']})]})]}),e.jsx(p,{className:"button button--green",to:"/vote-art",children:"Vote Art"})]}),e.jsx(x,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{}),e.jsxs("section",{className:"voting",children:[e.jsxs("div",{className:"voting__head",children:[e.jsx("h2",{children:"Choose next month's theme"}),e.jsx("p",{children:"You have one vote, pick the idea you’re most excited to create with."})]}),e.jsxs("div",{className:"voting__count-down",children:[e.jsx("p",{className:"voting__ends",children:"Voting ends in"}),e.jsxs("ul",{className:"voting__days",children:[e.jsxs("li",{children:[e.jsx("span",{children:m.days})," days"]}),e.jsxs("li",{children:[e.jsx("span",{children:m.hours})," h"]}),e.jsxs("li",{children:[e.jsx("span",{children:m.minutes})," min"]})]})]}),e.jsxs("form",{onSubmit:w,className:"form",children:[e.jsx("div",{className:"form__theme-options",children:s.map(t=>e.jsxs("label",{className:"form__theme-option",children:[e.jsx("input",{type:"radio",name:"themeId",value:t.id,required:!0}),e.jsx("span",{children:t.name})]},t.id))}),e.jsx("button",{className:"form__submit",type:"submit",children:"Vote"})]})]})]}),_&&e.jsx("div",{style:i.state==="idle"?null:{pointerEvents:"none"},onClick:u,className:"confirmation-popup",children:e.jsxs("div",{onClick:t=>t.stopPropagation(),className:"confirmation-popup__content",children:[e.jsxs("div",{className:"confirmation-popup__head",children:[e.jsxs("p",{className:"confirmation-popup__choise",children:["Are you sure, you want to lock in “",s.find(t=>t.id===h).name,"”? "]}),e.jsx("p",{className:"confirmation-popup__extra",children:"*You won’t be able to recast your vote after it has been submitted "})]}),e.jsxs("div",{className:"confirmation-popup__buttons",children:[e.jsx("button",{onClick:T,className:"confirmation-popup__yes",children:i.state==="idle"?"Yes":"Voting..."}),e.jsx("button",{onClick:u,className:"confirmation-popup__no",children:"No"})]})]})})]})},K=k(Y);export{H as clientAction,G as clientLoader,K as default};
