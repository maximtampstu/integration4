import{w as o}from"./with-props-DYauBgyy.js";import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{v as l,w as p,t as u,L as m}from"./chunk-DQRVZFIR-CNgL96Wu.js";import{b as c,u as y}from"./art-CBE29fTF.js";import"./supabase-BcYPN25z.js";const g=async a=>{const i=new FormData;i.append("file",a),i.append("upload_preset","media_upload_preset");const e=await fetch("https://api.cloudinary.com/v1_1/dngqj5iyc/auto/upload",{method:"POST",body:i});if(!e.ok)throw new Error("Upload failed");return await e.json()};async function w({params:a}){return{art:await c(Number(a.id))}}async function I({request:a,params:i}){const e=await a.formData(),r=e.get("media");let n=e.get("existingUrl"),d=e.get("type");if(r&&r.name){n=(await g(r)).secure_url;const s=n.split(".").pop();["mp4","mov","webm"].includes(s)?d="video":["mp3","wav","ogg"].includes(s)?d="audio":d="image"}return await y({id:Number(i.id),title:e.get("title"),description:e.get("description"),url:n,type:d,artTypeId:Number(e.get("artTypeId")),eventId:Number(e.get("eventId")),userId:Number(e.get("userId")),visibility:e.get("visibility")==="true"},i.id),l("/my-gallery")}const T=o(function({loaderData:i}){const{art:e}=i,n=p().state==="submitting";return e?t.jsxs("main",{className:"edit-art-page",children:[t.jsx("h1",{children:"Edit Artwork"}),n&&t.jsx("p",{children:"Uploading..."}),t.jsxs(u,{method:"post",encType:"multipart/form-data",children:[t.jsxs("label",{children:["Title:",t.jsx("input",{name:"title",defaultValue:e.title,required:!0})]}),t.jsxs("label",{children:["Description:",t.jsx("textarea",{name:"description",defaultValue:e.description,required:!0})]}),t.jsxs("label",{children:["Replace File:",t.jsx("input",{type:"file",name:"media",accept:"image/*,audio/*,video/*"})]}),t.jsx("input",{type:"hidden",name:"existingUrl",value:e.url}),t.jsx("input",{type:"hidden",name:"type",value:e.type}),t.jsx("input",{type:"hidden",name:"artTypeId",value:e.artTypeId}),t.jsx("input",{type:"hidden",name:"eventId",value:e.eventId}),t.jsx("input",{type:"hidden",name:"userId",value:e.userId}),t.jsx("input",{type:"hidden",name:"visibility",value:e.visibility}),t.jsx("button",{type:"submit",children:"Update"}),t.jsx(m,{to:"/my-gallery",children:"Cancel"})]})]}):t.jsx("p",{children:"Artwork not found."})});export{I as clientAction,w as clientLoader,T as default};
