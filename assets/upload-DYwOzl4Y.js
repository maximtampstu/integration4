import{w as _}from"./with-props-B93zY1wZ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{m as x}from"./art-BsMJH1cu.js";import{v as g,w as b,a as v,L as p,t as j}from"./chunk-DQRVZFIR-B4fErBJ-.js";import{a as N}from"./users-BK9jrEEb.js";import{b as w}from"./events-CHg21iI2.js";/* empty css                   */import"./supabase-B2tzS42n.js";const y="data:image/svg+xml,%3csvg%20width='49'%20height='39'%20viewBox='0%200%2049%2039'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M25.4325%202.23185L23.135%202.23185L21.4119%2022.3186L27.1557%2022.3186L25.4325%202.23185Z'%20fill='black'/%3e%3cpath%20d='M21.5299%20-1.4586e-05L15.0938%2013.3912L20.2631%2013.3912L24.3147%202.54312L28.3044%2013.3912L33.4738%2013.3912L27.0996%20-1.45196e-05L21.5299%20-1.4586e-05Z'%20fill='black'/%3e%3cpath%20d='M4.13551%204.59489L1.77236%204.59489L0%2038.7292L5.90787%2038.7292L4.13551%204.59489Z'%20fill='black'/%3e%3cpath%20d='M46.8035%204.59489L44.4403%204.59489L42.668%2038.7292L48.5758%2038.7292L46.8035%204.59489Z'%20fill='black'/%3e%3crect%20x='3.28125'%20y='30.1958'%20width='40.6987'%20height='8.53359'%20fill='black'/%3e%3c/svg%3e",L="/integration4/assets/upload_motion-B2ovJ8Hb.svg";async function Z(){const t=await N(),s=await w();return{currentUser:t,currentEvent:s}}async function B({request:t,params:s}){const a=await t.formData(),m=Number(s.id),r=a.get("title"),n=a.get("description"),d=a.get("visibility")==="on",i=a.get("file");if(!i||i.size===0)throw new Error("File is required");const c=Number(a.get("eventId")),l=Number(a.get("userId")),o=new FormData;o.append("file",i),o.append("upload_preset","media_upload_preset"),o.append("cloud_name","dngqj5iyc");const u=(await(await fetch("https://api.cloudinary.com/v1_1/dngqj5iyc/auto/upload",{method:"POST",body:o})).json()).secure_url,h=i.type.startsWith("audio/")?"audio":i.type.startsWith("video/")?"video":i.type.startsWith("image/")?"image":"unknown",f=await x({userId:l,title:r,description:n,visibility:d,url:u,type:h,eventId:c,artTypeId:m});return g(`/upload-success/${f.id}`)}const k=({loaderData:t})=>{const{currentUser:s,currentEvent:a}=t,r=b().state==="submitting",[n,d]=v.useState("No file chosen"),i=c=>{const l=c.target.files[0];d(l?l.name:"No file chosen")};return e.jsxs("main",{className:"upload-form",children:[e.jsx("h1",{className:"visually-hidden",children:"Upload Your Artwork"}),e.jsxs("div",{className:"upload-form__header",children:[e.jsxs(p,{to:"/upload",className:"upload-form__back",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M5.846e-08 9.09764L14 14L14 9.38047L2.65875 6.97643L14 4.57239L14 1.66948e-07L1.0905e-07 4.85522L5.846e-08 9.09764Z",fill:"black"})}),"Back"]}),e.jsx("img",{src:L,alt:"Upload header",className:"upload-form__image"})]}),e.jsx("article",{children:e.jsxs(j,{method:"post",encType:"multipart/form-data",className:"media-form",children:[e.jsx("input",{type:"hidden",name:"userId",value:s.id}),e.jsx("input",{type:"hidden",name:"eventId",value:a.id}),e.jsxs("div",{className:"media-form__file",children:[r&&e.jsx("p",{className:"media-form__uploading-message",children:"Uploading..."}),e.jsxs("div",{className:"media-form__field-upload",children:[e.jsxs("div",{className:"media-form__upload-label",children:[e.jsx("label",{htmlFor:"file",className:"media-form__label-upload",children:"Choose a file to upload"}),e.jsx("img",{src:y,alt:"Upload icon",className:"media-form__upload-icon"})]}),e.jsx("input",{type:"file",id:"file",name:"file",className:"media-form__input",style:{display:"none"},onChange:i})]}),e.jsx("div",{className:"media-form__filename",children:n})]}),e.jsxs("div",{className:"media-form__fields",children:[e.jsxs("div",{className:"media-form__field-title",children:[e.jsx("label",{htmlFor:"title",className:"media-form__label-title",children:"Title"}),e.jsx("input",{type:"text",id:"title",name:"title",className:"media-form__input",placeholder:"Artwork title",required:!0})]}),e.jsxs("div",{className:"media-form__field-description",children:[e.jsx("label",{htmlFor:"description",className:"media-form__label-description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",className:"media-form__input",placeholder:"Tell Abby what weâ€™re seeing..."})]})]}),e.jsxs("div",{className:"media-form__actions",children:[e.jsx("button",{type:"submit",className:"media-form__button media-form__button--primary",children:"Submit"}),e.jsx(p,{to:"/",className:"media-form__button media-form__button--secondary",children:"Cancel"})]}),e.jsx("div",{className:"media-form__field-checkbox",children:e.jsxs("label",{className:"media-form__label media-form__checkbox",children:[e.jsx("input",{type:"checkbox",name:"visibility",required:!0}),"I own the rights & grant Abby a 1-month exhibition licence."]})})]})})]})},S=_(k);export{B as clientAction,Z as clientLoader,S as default};
