import{w as v}from"./with-props-DYauBgyy.js";import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{c as h,g as x,m as j,n as _}from"./art-CBE29fTF.js";import{b as g}from"./events-BNYvvYLM.js";import{a as f,g as w}from"./users-BpYIlJRP.js";import{v as N,a as A,L as p,t as b}from"./chunk-DQRVZFIR-CNgL96Wu.js";import"./supabase-BcYPN25z.js";async function U({params:o}){const r=await h(Number(o.id)),s=await g(),a=await f(),c=await w(),i=await x(),n=await j(s.id,r.id),l=n.find(m=>i.some(d=>d.artId===m.id&&d.userId===a.id));return{artworks:n,artType:r,users:c,votedArt:l,currentUser:a}}async function B({request:o}){const r=await o.formData(),s=Number(r.get("artId")),a=Number(r.get("userId"));return await _(s,a),N(`/vote-complete/${s}`)}const L=v(function({loaderData:r}){const{artworks:s,users:a,artType:c,votedArt:i,currentUser:n}=r,[l,m]=A.useState(null),d=e=>{m(e.target.value)};return t.jsx("main",{className:"vote-art-type",children:t.jsxs("div",{className:"vote-art-type__container",children:[t.jsxs("h1",{className:"vote-art-type__title",children:["Voting for ",c.name]}),t.jsx(p,{to:"/vote-art",className:"vote-art-type__back",children:"← Back to Types"}),i?t.jsxs("p",{children:["You’ve already voted for: ",t.jsx("strong",{children:i.title})]}):t.jsxs(b,{method:"post",children:[t.jsx("input",{type:"hidden",name:"userId",value:n.id}),t.jsx("div",{className:"vote-art-type__grid",children:s.map(e=>{const u=a.find(y=>y.id===e.userId);return t.jsxs("div",{className:"vote-art-type__card",children:[t.jsx("h2",{className:"vote-art-type__card-title",children:e.title}),t.jsxs("p",{className:"vote-art-type__card-creator",children:[t.jsx("strong",{children:"Creator:"})," ",u==null?void 0:u.username]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"artId",value:e.id,onChange:d,required:!0})," Vote for this"]}),e.url.endsWith(".mp3")?t.jsx("audio",{controls:!0,style:{width:"100%"},children:t.jsx("source",{src:e.url,type:"audio/mpeg"})}):e.type==="video"?t.jsx("video",{controls:!0,width:"100%",children:t.jsx("source",{src:e.url,type:"video/mp4"})}):t.jsx("img",{src:e.url,alt:e.title,className:"vote-art-type__image"}),t.jsx("p",{className:"vote-art-type__description",children:e.description}),t.jsx(p,{to:`/art-detail/${e.id}`,className:"vote-art-type__detail-link",children:"View Details"})]},e.id)})}),t.jsx("button",{type:"submit",disabled:!l,className:"vote-art-type__submit",children:"Submit Vote"})]})]})})});export{B as clientAction,U as clientLoader,L as default};
