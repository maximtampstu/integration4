import{w as y}from"./with-props-sCgrmHZr.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{g as k,a as v,b as I}from"./users-Dw2hlNRA.js";import{d as w}from"./events-PY5RSDSP.js";import{b as _,c as N}from"./art-AYjM_fPO.js";import{s as x}from"./supabase-gzL5jvvo.js";import{s as C,a as p,L as F}from"./chunk-DQRVZFIR-DIhVU3QH.js";const A=async s=>{try{let{data:r,error:t}=await x.from("Feedback").select("*").eq("artId",s);if(t)console.log(" get contact err",t);else return r.length===0?[]:r}catch(r){throw console.error("Error fetching notes:",r),r}},E=async(s,r,t)=>{try{const{data:a,error:n}=await x.from("Feedback").insert([{artId:s,userId:r,feedback:t}]).select();return a[0]}catch(a){throw console.error("Error adding feedback:",a),a}};async function Y({params:s}){const r=await _(s.id),t=await k(),a=await w(r.eventId),n=await N(r.artTypeId),c=await A(r.id),o=(await v()).id,d=await I(r.userId);return{art:r,users:t,event:a,artType:n,feedback:c,currentUserId:o,creator:d}}async function G({request:s}){const r=await s.formData(),t=Number(r.get("artId")),a=Number(r.get("userId")),n=r.get("feedback");await E(t,a,n)}const P=y(function({loaderData:r}){const{art:t,users:a,event:n,artType:c,feedback:o,currentUserId:d,creator:l}=r,b=C(),[f,u]=p.useState(!1),[m,h]=p.useState(""),j=i=>{i.preventDefault(),b.submit({artId:t.id,userId:d,feedback:m},{method:"post"}),u(!1),h("")};return e.jsxs("main",{className:"art-detail",children:[e.jsxs("div",{className:"art-detail__container",children:[e.jsx(F,{to:`/previous-events/${t.eventId}`,className:"art-detail__back",children:"Back to Event Gallery"}),e.jsx("h1",{className:"art-detail__title",children:t.title}),e.jsx("p",{className:"art-detail__tag",children:(c==null?void 0:c.name)||"Unknown Tag"}),e.jsx("p",{className:"art-detail__theme",children:(n==null?void 0:n.name)||"Untitled Event"}),e.jsxs("p",{className:"art-detail__creator",children:[e.jsx("strong",{children:"Creator:"})," ",l==null?void 0:l.username]}),e.jsx("div",{className:"art-detail__media",children:t.url.endsWith(".mp3")?e.jsxs("audio",{controls:!0,style:{width:"100%"},children:[e.jsx("source",{src:t.url,type:"audio/mpeg"}),"Your browser does not support the audio tag."]}):t.type==="video"?e.jsxs("video",{controls:!0,width:"100%",children:[e.jsx("source",{src:t.url,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("img",{src:t.url,alt:t.title,className:"art-detail__image"})}),e.jsx("p",{className:"art-detail__description",children:t.description})]}),e.jsxs("div",{className:"feedback",children:[e.jsxs("form",{onSubmit:j,children:[e.jsx("label",{children:"Feedback"}),e.jsx("input",{type:"hidden",name:"artId",value:t.id}),e.jsx("input",{type:"hidden",name:"userId",value:d}),e.jsx("input",{onClick:()=>u(!0),onChange:i=>h(i.target.value),type:"text",name:"feedback",value:m,required:!0}),f&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>u(!1),children:"Cancel"}),e.jsx("button",{type:"submit",children:"Comment"})]})]}),e.jsx("ul",{children:o.length>0?o.map(i=>e.jsxs("li",{children:[e.jsx("img",{src:"#",alt:"Avatar"}),e.jsx("p",{children:a.find(g=>g.id===Number(i.userId)).username}),e.jsx("p",{children:i.feedback})]},i.id)):e.jsx("li",{children:"No feedback available"})})]})]})});export{G as clientAction,Y as clientLoader,P as default};
