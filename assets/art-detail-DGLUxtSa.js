import{w as F}from"./with-props-B93zY1wZ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{g as I,a as C,b as M}from"./users-BK9jrEEb.js";import{d as Z,b as L}from"./events-CywvQxlv.js";import{b as B,c as E,d as A,e as D}from"./art-BsMJH1cu.js";import{s as k}from"./supabase-B2tzS42n.js";import{a as h}from"./arrow-CMmgFB8Y.js";import{s as P,a as g,L as S}from"./chunk-DQRVZFIR-B4fErBJ-.js";const $=async d=>{try{let{data:s,error:t}=await k.from("Feedback").select("*").eq("artId",d);if(t)console.log(" get contact err",t);else return s.length===0?[]:s}catch(s){throw console.error("Error fetching notes:",s),s}},U=async(d,s,t)=>{try{const{data:l,error:c}=await k.from("Feedback").insert([{artId:d,userId:s,feedback:t}]).select();return l[0]}catch(l){throw console.error("Error adding feedback:",l),l}},R="data:image/svg+xml,%3csvg%20width='32'%20height='46'%20viewBox='0%200%2032%2046'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.9573%2018.28C14.3573%2018.28%2013.0773%2016.96%2013.0773%2015.36C13.0773%2013.76%2014.3573%2012.44%2015.9573%2012.44C17.5973%2012.44%2018.9173%2013.76%2018.9173%2015.36C18.9173%2016.96%2017.5973%2018.28%2015.9573%2018.28ZM15.9573%2028.28C14.3573%2028.28%2013.0773%2026.96%2013.0773%2025.36C13.0773%2023.76%2014.3573%2022.44%2015.9573%2022.44C17.5973%2022.44%2018.9173%2023.76%2018.9173%2025.36C18.9173%2026.96%2017.5973%2028.28%2015.9573%2028.28ZM15.9573%2038.28C14.3573%2038.28%2013.0773%2036.96%2013.0773%2035.36C13.0773%2033.76%2014.3573%2032.44%2015.9573%2032.44C17.5973%2032.44%2018.9173%2033.76%2018.9173%2035.36C18.9173%2036.96%2017.5973%2038.28%2015.9573%2038.28Z'%20fill='black'/%3e%3c/svg%3e";async function Q({params:d}){const s=await B(d.id),t=await I(),l=await Z(s.eventId),c=await E(s.artTypeId),m=await $(s.id),n=(await C()).id,x=await M(s.userId),o=await C(),r=await A(o.id),j=await L(),f=await D(l.id);return{art:s,users:t,event:l,artType:c,feedback:m,currentUserId:n,creator:x,currentUser:o,totalVotes:r,currentEvent:j,allArtInCategory:f}}async function X({request:d}){const s=await d.formData(),t=Number(s.get("artId")),l=Number(s.get("userId")),c=s.get("feedback");await U(t,l,c)}const ee=F(function({loaderData:s}){const{art:t,users:l,event:c,artType:m,feedback:n,currentUserId:x,creator:o,currentUser:r,totalVotes:j,currentEvent:f,allArtInCategory:p}=s,y=P(),[T,v]=g.useState(!1),[w,N]=g.useState(""),[_,V]=g.useState(!1),b=()=>V(a=>!a);console.log(p);const H=a=>{a.preventDefault(),y.submit({artId:t.id,userId:x,feedback:w},{method:"post"}),v(!1),N("")};return e.jsxs("main",{className:"art-detail",children:[e.jsx("h1",{className:"visually-hidden",children:" at detail page"}),e.jsxs("article",{className:"art-detail__section",children:[e.jsx("h2",{className:"visually-hidden",children:" art detail section"}),e.jsxs("section",{className:"art-detail__header",children:[e.jsx("h3",{className:"visually-hidden",children:" detail header"}),e.jsxs(S,{to:"/my-gallery",className:"art-detail__back",children:[e.jsx("img",{src:h,alt:"Back arrow",className:"art-detail__arrowing"}),"Back"]}),e.jsx("div",{className:"art-detail__media",children:t.url.endsWith(".mp3")?e.jsxs("audio",{controls:!0,style:{width:"100%"},className:"art-detail__audio",children:[e.jsx("source",{src:t.url,type:"audio/mpeg"}),"Your browser does not support the audio tag."]}):t.type==="video"?e.jsxs("video",{controls:!0,width:"100%",className:"art-detail__video",children:[e.jsx("source",{src:t.url,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("img",{src:t.url,alt:t.title,className:"art-detail__image"})})]}),e.jsxs("section",{className:"art-detail__meta",children:[e.jsx("h3",{className:"visually-hidden",children:"art detail meta"}),e.jsxs("div",{className:"art-detail__meta-info",children:[e.jsxs("div",{className:"art-detail__meta-group",children:[e.jsx("p",{className:"art-detail__title",children:t.title}),e.jsxs("p",{className:"art-detail__creator",children:["by",e.jsxs("span",{children:[" @",o==null?void 0:o.username]})]})]}),e.jsx("div",{className:"art-detail__meta-group",children:e.jsx("p",{className:"art-detail__tag",children:(m==null?void 0:m.name)||"Unknown Tag"})})]}),e.jsxs("div",{className:"art-detail__meta-extra",children:[e.jsxs("div",{className:"art-detail__theme-block",children:[e.jsx("img",{src:h,alt:"arrow",className:"art-detail__icon"}),e.jsxs("p",{className:"art-detail__theme",children:["published for ",e.jsx("span",{children:(c==null?void 0:c.name)||"Untitled Event"})]})]}),e.jsxs("div",{className:"art-detail__votes-block",children:[e.jsx("img",{src:h,alt:"arrow",className:"art-detail__icon"}),e.jsxs("p",{className:"art-detail__votes",children:[e.jsx("span",{children:j})," votes"]})]})]})]}),e.jsxs("section",{className:`art-detail__description-block ${_?"open":""}`,children:[e.jsx("h3",{className:"visually-hidden",children:" art description "}),e.jsxs("div",{className:"art-detail__description-toggle",onClick:b,role:"button",tabIndex:0,onKeyDown:a=>a.key==="Enter"&&b(),children:[e.jsx("p",{className:"art-detail__toggle-text",children:_?"Hide description":"Read description"}),e.jsx("img",{src:h,alt:"",className:`art-detail__arrow ${_?"rotated":""}`,"aria-hidden":"true"})]}),_&&e.jsx("p",{className:"art-detail__description",children:t.description})]})]}),e.jsxs("section",{className:"art-detail__feedback",children:[e.jsx("h2",{className:"visually-hidden",children:"feedback"}),e.jsxs("section",{className:"art-detail__feedback-form-block",children:[e.jsx("h3",{className:"art-detail__feedback-title",children:"feedback"}),e.jsxs("form",{onSubmit:H,className:"art-detail__feedback-form",children:[e.jsx("label",{className:"visually-hidden",children:"Feedback"}),e.jsx("input",{type:"hidden",name:"artId",value:t.id}),e.jsx("input",{type:"hidden",name:"userId",value:x}),e.jsx("div",{className:"art-detail__feedback-icon",children:e.jsxs("svg",{className:"",width:"24",height:"45",viewBox:"0 0 24 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{"clip-path":"url(#clip0_828_2413)",children:[e.jsx("path",{d:"M14.5497 8.80082C14.5497 7.25126 13.2935 5.99508 11.7439 5.99507C10.1944 5.99507 8.93818 7.25124 8.93818 8.80082V9.19675H3.00293V8.80082C3.00293 3.97331 6.91643 0.0598145 11.7439 0.0598145C16.5714 0.0598262 20.4849 3.9733 20.4849 8.80082V9.19675H14.5497V8.80082Z",fill:"#231F20"}),e.jsx("path",{d:"M3.00293 8.86553V8.4696H8.93818V8.86553C8.9382 10.4151 10.1944 11.6713 11.7439 11.6713C13.2935 11.6713 14.5497 10.415 14.5497 8.86553V8.4696H20.4849V8.86553C20.4849 13.693 16.5714 17.6065 11.7439 17.6065C6.91644 17.6065 3.00295 13.693 3.00293 8.86553Z",fill:"#231F20"}),e.jsx("path",{d:"M18.0395 37.1339H5.7373V44.9037H18.0395V37.1339Z",fill:"#231F20"}),e.jsx("path",{d:"M23.3276 44.9037H15.748L10.8633 18.5237H15.2338L23.3276 44.9037Z",fill:"#231F20"}),e.jsx("path",{d:"M0.179688 44.9037H7.75937L12.644 18.5237H8.27352L0.179688 44.9037Z",fill:"#231F20"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_828_2413",children:e.jsx("rect",{width:"23.5252",height:"45",fill:"white"})})})]})}),e.jsxs("div",{className:"art-detail__feedback-controls",children:[e.jsx("input",{onClick:()=>v(!0),onChange:a=>N(a.target.value),type:"text",name:"feedback",value:w,required:!0,placeholder:"leave a comemnt"}),e.jsx("button",{type:"submit",children:e.jsx("img",{src:h,alt:"Back arrow",className:"art-detail-form__arrow"})})]})]})]}),e.jsxs("section",{className:"art-detail__feedback-list-section",children:[e.jsx("h3",{className:"visually-hidden",children:"feedback list"}),e.jsxs("div",{className:"art-detail__feedback-count",children:[n.length,e.jsx("p",{children:n.length>1?"comments":"comment"})]}),e.jsx("ul",{className:"art-detail__feedback-list",children:n.length>0?n.map(a=>e.jsxs("li",{className:"art-detail__feedback-item",children:[e.jsx("div",{className:"art-detail__feedback-avatar",children:(r==null?void 0:r.avatar)===null?e.jsxs("svg",{className:"",width:"24",height:"45",viewBox:"0 0 24 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{"clip-path":"url(#clip0_828_2413)",children:[e.jsx("path",{d:"M14.5497 8.80082C14.5497 7.25126 13.2935 5.99508 11.7439 5.99507C10.1944 5.99507 8.93818 7.25124 8.93818 8.80082V9.19675H3.00293V8.80082C3.00293 3.97331 6.91643 0.0598145 11.7439 0.0598145C16.5714 0.0598262 20.4849 3.9733 20.4849 8.80082V9.19675H14.5497V8.80082Z",fill:"#231F20"}),e.jsx("path",{d:"M3.00293 8.86553V8.4696H8.93818V8.86553C8.9382 10.4151 10.1944 11.6713 11.7439 11.6713C13.2935 11.6713 14.5497 10.415 14.5497 8.86553V8.4696H20.4849V8.86553C20.4849 13.693 16.5714 17.6065 11.7439 17.6065C6.91644 17.6065 3.00295 13.693 3.00293 8.86553Z",fill:"#231F20"}),e.jsx("path",{d:"M18.0395 37.1339H5.7373V44.9037H18.0395V37.1339Z",fill:"#231F20"}),e.jsx("path",{d:"M23.3276 44.9037H15.748L10.8633 18.5237H15.2338L23.3276 44.9037Z",fill:"#231F20"}),e.jsx("path",{d:"M0.179688 44.9037H7.75937L12.644 18.5237H8.27352L0.179688 44.9037Z",fill:"#231F20"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_828_2413",children:e.jsx("rect",{width:"23.5252",height:"45",fill:"white"})})})]}):e.jsx("img",{className:"art-detail__avatar-img",src:r==null?void 0:r.avatar,alt:`avatar of ${r==null?void 0:r.username}`})}),e.jsxs("div",{className:"art-detail__feedback-content",children:[e.jsx("img",{src:h,alt:"arrow",className:"art-detail__feedback-arrow"}),e.jsx("p",{className:"art-detail__feedback-text",children:a.feedback}),e.jsx("img",{className:"art-detail__feedback-dots",src:R,alt:"arrow"})]})]},a.id)):e.jsx("li",{className:"art-detail__feedback-empty",children:"No feedback available"})})]})]}),e.jsxs("section",{className:"art-detail__related",children:[e.jsx("h2",{className:"art-detail__related-title",children:"in this category"}),e.jsx("section",{className:"art-grid",children:p.map(a=>{const i=l.find(u=>u.id===a.userId);return e.jsxs("div",{className:"art-card",children:[e.jsx("div",{className:"art-card__media",children:a.url.endsWith(".mp3")||a.type==="music"?e.jsx("audio",{controls:!0,style:{width:"100%"},children:e.jsx("source",{src:a.url,type:"audio/mpeg"})}):a.type==="video"?e.jsx("video",{controls:!0,width:"100%",children:e.jsx("source",{src:a.url,type:"video/mp4"})}):e.jsx("img",{src:a.url,alt:a.title,className:"art-card__image"})}),e.jsxs("div",{className:"art-card__info",children:[e.jsx("div",{className:"art-card__creator-avatar",children:i!=null&&i.avatar?e.jsx("img",{src:i.avatar,alt:`avatar of ${i.username}`,className:"art-card__avatar-img"}):e.jsxs("svg",{width:"24",height:"45",viewBox:"0 0 24 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{clipPath:"url(#clip0_828_2413)",children:[e.jsx("path",{d:"M14.5497 8.80082C14.5497 7.25126 13.2935 5.99508 11.7439 5.99507C10.1944 5.99507 8.93818 7.25124 8.93818 8.80082V9.19675H3.00293V8.80082C3.00293 3.97331 6.91643 0.0598145 11.7439 0.0598145C16.5714 0.0598262 20.4849 3.9733 20.4849 8.80082V9.19675H14.5497V8.80082Z",fill:"#231F20"}),e.jsx("path",{d:"M3.00293 8.86553V8.4696H8.93818V8.86553C8.9382 10.4151 10.1944 11.6713 11.7439 11.6713C13.2935 11.6713 14.5497 10.415 14.5497 8.86553V8.4696H20.4849V8.86553C20.4849 13.693 16.5714 17.6065 11.7439 17.6065C6.91644 17.6065 3.00295 13.693 3.00293 8.86553Z",fill:"#231F20"}),e.jsx("path",{d:"M18.0395 37.1339H5.7373V44.9037H18.0395V37.1339Z",fill:"#231F20"}),e.jsx("path",{d:"M23.3276 44.9037H15.748L10.8633 18.5237H15.2338L23.3276 44.9037Z",fill:"#231F20"}),e.jsx("path",{d:"M0.179688 44.9037H7.75937L12.644 18.5237H8.27352L0.179688 44.9037Z",fill:"#231F20"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_828_2413",children:e.jsx("rect",{width:"23.5252",height:"45",fill:"white"})})})]})}),e.jsxs("div",{className:"art-card__text",children:[e.jsx("p",{className:"art-card__title",children:a.title}),e.jsxs("p",{className:"art-card__username",children:["@",(i==null?void 0:i.username)||"unknown"]})]})]})]},a.id)})}),e.jsx("section",{className:"art-grid",children:p.map(a=>{const i=l.find(u=>u.id===a.userId);return e.jsxs("div",{className:"art-card",children:[e.jsx("div",{className:"art-card__media",children:a.url.endsWith(".mp3")||a.type==="music"?e.jsx("audio",{controls:!0,style:{width:"100%"},children:e.jsx("source",{src:a.url,type:"audio/mpeg"})}):a.type==="video"?e.jsx("video",{controls:!0,width:"100%",children:e.jsx("source",{src:a.url,type:"video/mp4"})}):e.jsx("img",{src:a.url,alt:a.title,className:"art-card__image"})}),e.jsxs("div",{className:"art-card__info",children:[e.jsx("div",{className:"art-card__creator-avatar",children:i!=null&&i.avatar?e.jsx("img",{src:i.avatar,alt:`avatar of ${i.username}`,className:"art-card__avatar-img"}):e.jsxs("svg",{width:"24",height:"45",viewBox:"0 0 24 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{clipPath:"url(#clip0_828_2413)",children:[e.jsx("path",{d:"M14.5497 8.80082C14.5497 7.25126 13.2935 5.99508 11.7439 5.99507C10.1944 5.99507 8.93818 7.25124 8.93818 8.80082V9.19675H3.00293V8.80082C3.00293 3.97331 6.91643 0.0598145 11.7439 0.0598145C16.5714 0.0598262 20.4849 3.9733 20.4849 8.80082V9.19675H14.5497V8.80082Z",fill:"#231F20"}),e.jsx("path",{d:"M3.00293 8.86553V8.4696H8.93818V8.86553C8.9382 10.4151 10.1944 11.6713 11.7439 11.6713C13.2935 11.6713 14.5497 10.415 14.5497 8.86553V8.4696H20.4849V8.86553C20.4849 13.693 16.5714 17.6065 11.7439 17.6065C6.91644 17.6065 3.00295 13.693 3.00293 8.86553Z",fill:"#231F20"}),e.jsx("path",{d:"M18.0395 37.1339H5.7373V44.9037H18.0395V37.1339Z",fill:"#231F20"}),e.jsx("path",{d:"M23.3276 44.9037H15.748L10.8633 18.5237H15.2338L23.3276 44.9037Z",fill:"#231F20"}),e.jsx("path",{d:"M0.179688 44.9037H7.75937L12.644 18.5237H8.27352L0.179688 44.9037Z",fill:"#231F20"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_828_2413",children:e.jsx("rect",{width:"23.5252",height:"45",fill:"white"})})})]})}),e.jsxs("div",{className:"art-card__text",children:[e.jsx("p",{className:"art-card__title",children:a.title}),e.jsxs("p",{className:"art-card__username",children:["@",(i==null?void 0:i.username)||"unknown"]})]})]})]},a.id)})})]})]})});export{X as clientAction,Q as clientLoader,ee as default};
