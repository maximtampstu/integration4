import{w as L}from"./with-props-BUJaXTv7.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{t as D,a as h,w as F}from"./chunk-DQRVZFIR-CGfc0zaK.js";import{a as I,g as q,b as M}from"./theme-CjC2d-7A.js";import{B as P}from"./BackButton-CMOcTwVr.js";import"./supabase-C7s_kt8r.js";/* empty css                   */const _={_origin:"https://api.emailjs.com"},R=(s,t="https://api.emailjs.com")=>{_._userID=s,_._origin=t},S=(s,t,a)=>{if(!s)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!a)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class w{constructor(t){this.status=t.status,this.text=t.responseText}}const V=(s,t,a={})=>new Promise((l,r)=>{const c=new XMLHttpRequest;c.addEventListener("load",({target:i})=>{const m=new w(i);m.status===200||m.text==="OK"?l(m):r(m)}),c.addEventListener("error",({target:i})=>{r(new w(i))}),c.open("POST",_._origin+s,!0),Object.keys(a).forEach(i=>{c.setRequestHeader(i,a[i])}),c.send(t)}),B=(s,t,a,l)=>{const r=l||_._userID;return S(r,s,t),V("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:r,service_id:s,template_id:t,template_params:a}),{"Content-type":"application/json"})},O=s=>{let t;if(typeof s=="string"?t=document.querySelector(s):t=s,!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return t},H=(s,t,a,l)=>{const r=l||_._userID,c=O(a);S(r,s,t);const i=new FormData(c);return i.append("lib_version","3.2.0"),i.append("service_id",s),i.append("template_id",t),i.append("user_id",r),V("/api/v1.0/email/send-form",i)},A={init:R,send:B,sendForm:H},J=({state:s,themeVotes:t,changeState:a,themeId:l,ClosePopup:r,votableThemes:c})=>{const i=["@gmail.com","@outlook.com","@icloud.com","@yahoo.com","@hotmail.com","@telenet.be","@mail.com"],m=D(),y=h.useRef(null),[u,v]=h.useState(""),[x,d]=h.useState("/"),[k,g]=h.useState(""),[j,N]=h.useState(""),f=n=>{v(""),d("/"),g(""),N(""),n==="close"&&r(),n==="back"&&a("email")},o=n=>{if(n.preventDefault(),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)){d("Email requierd");return}if(t.some(p=>p.userEmail===u.toLowerCase()))d("You already have voted"),v("");else{d("/");const p=Math.floor(1e5+Math.random()*9e5).toString();g(p),a("code"),console.log(p),C(u.toLowerCase(),p)}},C=(n,b)=>{A.send("service_abby","template_54sdf8u",{email:n,code:b},"Satxo3KS8iiEr06Bj").then(p=>{console.log("Email sent:",p.text)},p=>{console.log("Failed to send:",p.text)})},E=n=>{const b=n.target.value.replace(/\D/g,"").slice(0,6);N(b)},T=n=>{n.preventDefault(),j===""?d("Pleas fill in your verification code"):j.length!==6?d("This code contains 6 digits"):j===k?m.submit({email:u.toLowerCase(),themeId:l},{method:"post"}):d("The code you entered is incorrect")};return e.jsx("div",{onClick:()=>f("close"),className:"vote-verification",children:e.jsxs("div",{onClick:n=>n.stopPropagation(),className:"vote-verification__content",children:[e.jsx("button",{type:"button",className:"kiosk-button kiosk-button--sec kiosk-button--small",onClick:()=>f("close"),children:"X"}),s==="email"?e.jsxs("form",{className:"vote-email",onSubmit:o,children:[e.jsxs("div",{className:"vote-email__head",children:[e.jsxs("div",{className:"vote-email__choice",children:[e.jsx("p",{children:"You picked"}),e.jsx("h3",{children:c.find(n=>n.id===Number(l)).name})]}),e.jsxs("div",{className:"vote-email__extra",children:[e.jsx("p",{className:"vote-email__info",children:"Enter your email to confirm your vote"}),e.jsx("p",{className:"vote-email__why",children:"*We ask for your email to avoid spam and make sure every vote counts from a real person, like you!"})]})]}),e.jsxs("div",{className:"vote-email__content",children:[e.jsxs("label",{children:[e.jsxs("div",{children:[e.jsx("span",{children:"Email"}),e.jsx("span",{style:{color:x==="/"?"transparent":"var(--color-lau-yellow)"},className:"vote-email__error",children:x})]}),e.jsx("input",{type:"text",name:"email",value:u,onChange:n=>{v(n.target.value),d("/")},placeholder:"john.doe@gmail.com"})]}),e.jsxs("ul",{children:[i.map(n=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>v(u+n),children:n},n)})),e.jsx("li",{children:e.jsx("button",{className:"vote-email__clear",type:"button",onClick:()=>v(""),children:"Clear"})})]}),e.jsxs("div",{className:"vote-verification__buttons",children:[e.jsx("button",{className:"kiosk-button kiosk-button--sec",type:"button",onClick:()=>f("close"),children:"Cancel"}),e.jsx("button",{className:"kiosk-button",type:"submit",children:"Send Code"})]})]})]}):e.jsxs("form",{className:"vote-code",onSubmit:T,children:[e.jsxs("div",{className:"vote-code__top",children:[e.jsxs("div",{className:"vote-code__head",children:[e.jsx("h3",{children:"Verify your email"}),e.jsxs("p",{children:["We sent a 6-digit code to ",e.jsx("span",{children:u})," Enter it below to confirm your vote."]})]}),e.jsxs("div",{className:"vote-code__mid",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",ref:y,inputMode:"numeric",autoComplete:"one-time-code",pattern:"[0-9]*",name:"verifyCode",maxLength:6,value:j,onChange:E,placeholder:"######"}),e.jsx("ul",{children:Array.from({length:6}).map((n,b)=>e.jsx("li",{children:j[b]||"_"},b))})]}),e.jsx("button",{type:"button",onClick:()=>C(u,k),children:"Resent code"})]})]}),e.jsx("p",{style:{color:x==="/"?"transparent":"var(--color-lau-yellow)"},className:"vote-code__error",children:x}),e.jsxs("div",{className:"vote-verification__buttons",children:[e.jsx("button",{className:"kiosk-button kiosk-button--sec",type:"button",onClick:()=>f("back"),children:"Change Email"}),e.jsx("button",{className:"kiosk-button",type:"submit",children:m.state==="loading"?"Verifying...":"Verify"})]})]})]})})};async function Q(){const s=await I(),t=await q();return{votableThemes:s,themeVotes:t}}async function U({request:s}){const t=await s.formData(),a=Number(t.get("themeId")),l=t.get("email");return await M(a,l),F(`/kiosk/vote-complete/${a}`)}const K=({loaderData:s={}})=>{const{votableThemes:t,themeVotes:a}=s,[l,r]=h.useState(null),[c,i]=h.useState(null),[m,y]=h.useState("/"),[u,v]=h.useState("email"),[x,d]=h.useState(""),k=o=>{v(o)},g=o=>{o.preventDefault(),c===null?y("Select a theme to vote"):d(o.target.theme.value)},j=()=>{v("email"),d("")},N=o=>{r(C=>C===o?null:o)},f=()=>{i(!0),y("/")};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"visually-hidden",children:"Vote Theme"}),e.jsxs("div",{className:"vote-theme__content",children:[e.jsxs("div",{className:"vote-theme__head",children:[e.jsx(P,{}),e.jsx("h2",{children:"Vote for the next theme"})]}),e.jsx("p",{className:"vote-theme__info",children:"Choose the theme that ignites your creativity and shapes Abbyâ€™s next immersive experience."}),e.jsxs("form",{className:"vote-theme__form",onSubmit:g,children:[t.map(o=>e.jsxs("div",{className:o.id===l||l===null?"vote-theme__radio-button":"visually-hidden",children:[e.jsxs("label",{onClick:()=>f(o.id),children:[e.jsx("input",{type:"radio",name:"theme",value:o.id}),e.jsx("span",{className:"theme-name",children:o.name}),e.jsx("span",{className:"square-icon"})]},o.id),e.jsxs("div",{className:o.id===l?"":"visually-hidden",children:[e.jsx("img",{src:o==null?void 0:o.thumbnail,alt:"Theme Thumbnail"}),e.jsx("p",{children:o.description})]}),e.jsx("button",{className:o.id===l?"vote-theme__expand-button vote-theme__expand-button--active":"vote-theme__expand-button",onClick:()=>N(o.id),type:"button",children:e.jsx("svg",{width:"26",height:"25",viewBox:"0 0 26 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M16.623 24.9616L25.3284 0.452387L17.2286 0.416193L12.9244 20.2831L8.79806 0.378522L0.780826 0.342698L9.18428 24.9284L16.623 24.9616Z",fill:"black"})})})]})),e.jsx("p",{className:"vote-theme__error",style:{color:m==="/"?"transparent":"var(--color-lau-orange)"},children:m}),e.jsx("button",{className:"kiosk-button kiosk-button--blue",type:"submit",children:"Vote"})]})]}),x!=""?e.jsx(J,{themeVotes:a,state:u,changeState:k,themeId:x,ClosePopup:j,votableThemes:t}):null]})},ee=L(K);export{U as clientAction,Q as clientLoader,ee as default};
