import{w as k}from"./with-props-sCgrmHZr.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{s as E,a as h,v as D}from"./chunk-DQRVZFIR-DIhVU3QH.js";import{a as q,g as F,b as L}from"./theme-BDPee_M5.js";import{B as I}from"./BackButton-CNyxKOt4.js";import"./supabase-gzL5jvvo.js";const p={_origin:"https://api.emailjs.com"},M=(o,t="https://api.emailjs.com")=>{p._userID=o,p._origin=t},S=(o,t,a)=>{if(!o)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!a)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class C{constructor(t){this.status=t.status,this.text=t.responseText}}const V=(o,t,a={})=>new Promise((m,r)=>{const i=new XMLHttpRequest;i.addEventListener("load",({target:s})=>{const c=new C(s);c.status===200||c.text==="OK"?m(c):r(c)}),i.addEventListener("error",({target:s})=>{r(new C(s))}),i.open("POST",p._origin+o,!0),Object.keys(a).forEach(s=>{i.setRequestHeader(s,a[s])}),i.send(t)}),P=(o,t,a,m)=>{const r=m||p._userID;return S(r,o,t),V("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:r,service_id:o,template_id:t,template_params:a}),{"Content-type":"application/json"})},B=o=>{let t;if(typeof o=="string"?t=document.querySelector(o):t=o,!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return t},O=(o,t,a,m)=>{const r=m||p._userID,i=B(a);S(r,o,t);const s=new FormData(i);return s.append("lib_version","3.2.0"),s.append("service_id",o),s.append("template_id",t),s.append("user_id",r),V("/api/v1.0/email/send-form",s)},R={init:M,send:P,sendForm:O},H=({state:o,themeVotes:t,changeState:a,themeId:m,ClosePopup:r})=>{const i=["@gmail.com","@outlook.com","@icloud.com","@yahoo.com","@hotmail.com","@telenet.be","@mail.com"],s=E(),[c,u]=h.useState(""),[b,l]=h.useState(""),[w,f]=h.useState(""),[j,g]=h.useState(""),x=n=>{u(""),l(""),f(""),g(""),n==="close"&&r(),n==="back"&&a("email")},T=n=>{if(n.preventDefault(),t.some(d=>d.userEmail===c))l("You already have voted");else{l("");const d=Math.floor(1e5+Math.random()*9e5).toString();f(d),a("code"),console.log(d),v(c,d)}},v=(n,y)=>{R.send("service_abby","template_54sdf8u",{email:n,code:y},"Satxo3KS8iiEr06Bj").then(d=>{console.log("Email sent:",d.text)},d=>{console.log("Failed to send:",d.text)})},_=n=>{n.preventDefault(),j===w?s.submit({email:c,themeId:m},{method:"post"}):l("wrong")};return e.jsxs("div",{style:{padding:"1rem",background:"#eee",width:"max-content"},children:[e.jsx("button",{type:"button",onClick:()=>x("close"),children:"X"}),o==="email"?e.jsxs("form",{onSubmit:T,children:[e.jsxs("label",{children:["email",e.jsx("input",{type:"text",name:"email",value:c,onChange:n=>u(n.target.value),placeholder:"john.doe@gmail.com",required:!0})]}),e.jsx("br",{}),b,e.jsx("br",{}),i.map(n=>e.jsx("button",{type:"button",onClick:()=>u(c+n),children:n},n)),e.jsx("br",{}),e.jsx("button",{type:"button",onClick:()=>u(""),children:"Clear"}),e.jsx("br",{}),e.jsx("button",{type:"button",onClick:()=>x("close"),children:"Cancel"}),e.jsx("button",{type:"submit",children:"Send Code"})]}):e.jsxs("form",{onSubmit:_,children:[e.jsxs("label",{children:["code",e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",name:"verifyCode",minLength:6,maxLength:6,value:j,onChange:n=>/^\d*$/.test(n.target.value)&&g(n.target.value),placeholder:"######",required:!0})]}),e.jsx("br",{}),e.jsx("button",{type:"button",onClick:()=>v(c,generatedCode),children:"Resent code"}),b,e.jsx("br",{}),e.jsx("button",{type:"button",onClick:()=>x("back"),children:"Change Email"}),e.jsx("button",{type:"submit",children:"Verify"})]})]})};async function z(){const o=await q(),t=await F();return{votableThemes:o,themeVotes:t}}async function G({request:o}){const t=await o.formData(),a=Number(t.get("themeId")),m=t.get("email");return await L(a,m),D(`/kiosk/vote-complete/${a}`)}const N=({loaderData:o})=>{const{votableThemes:t,themeVotes:a}=o,[m,r]=h.useState("email"),[i,s]=h.useState(""),c=l=>{r(l)},u=l=>{l.preventDefault(),s(l.target.theme.value)},b=()=>{r("email"),s("")};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Vote Theme"}),e.jsx(I,{}),e.jsx("p",{children:"Vote Theme"}),e.jsxs("form",{onSubmit:u,children:[t.map(l=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"theme",value:l.id,required:!0}),l.name]},l.id)),e.jsx("button",{type:"submit",children:"Vote"})]}),i!=""?e.jsx(H,{themeVotes:a,state:m,changeState:c,themeId:i,ClosePopup:b}):null]})},Q=k(N);export{G as clientAction,z as clientLoader,Q as default};
